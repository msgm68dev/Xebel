import random
import os
from evaluation.evaltools import flowset_dir
class TG:
    def __init__(self, n_flows, n_edges, rates=(1, 1), durations=(1, 1), arrivedAts=(0, 0)):
        self.n_flows = n_flows
        self.n_edges = n_edges
        self.edges = set(range(n_edges))
        self.min_rate = rates[0]
        self.max_rate = rates[1]
        self.min_duration = durations[0]
        self.max_duration = durations[1]
        self.min_arriveAt = arrivedAts[0]
        self.max_arriveAt = arrivedAts[1]
        
    def generate(self, filename, separator =','):
        ful_filename = os.path.join(flowset_dir, filename)
        with open(ful_filename, mode='w') as f:
            f.write("# Generated by my TrafficGenerator !\n")
            f.write("#Src,   Dst, Rate, ArriveAt, Duration\n")
            

            for i in range(self.n_flows):
                ie_pair = random.sample(self.edges, 2)
                src, dst = ie_pair
                rate = random.randint(self.min_rate, self.max_rate)
                dur = random.randint(self.min_duration, self.max_duration)
                aat = random.randint(self.min_arriveAt, self.max_arriveAt)
                entry = "{}{}\t\t{}{}\t\t{}{}\t\t{}{}\t\t{}\n".format(src, separator, dst, separator, rate, separator, aat, separator, dur)
                f.write(entry)
            f.close()
        print('Saved: {}'.format(ful_filename))

            